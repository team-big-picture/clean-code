# 16장 SerialDate 리팩터링

> JCommon 라이브러리를 뒤져보면 org.jfree.date라는 패키지가 있으며 여기에 SerialDate라는 클래스가 있다.

### 이 장에서는 바로 이 SerialDate를 탐험한다.

SerialDate를 구현한 사람은 데이비드 길버트이다. 엄청난 절제력과 전문가 정신을 보여준다. 의도와 목적을 고려하건대 SerialDate는 분명 우수한 코드다.
강조하건대, 이 장에서 수행하는 분석은 악의나 자만과는 거리가 멀다. 우리모두가 편안하게 여겨야 할 활동이다. 남이 내게 해준다면 감사히 반겨야 할 활동이다.
이와 같은 비판이 있어야만 발전도 가능하다. 의사들도 한다. 조종사들도 한다. 법률가들도 한다. 우리 프로그래머들도 방법을 배워야한다.
데이비드는 용감하게 자기 코드를 오픈소스로 공개하는 선의를 보였다. 누구나 사용하고 누구나 비판하라고 코드를 만천하에 공개했다. 참으로 훌륭한 행동이다.
SerialDate는 날짜를 표현하는 자바 클래스다. 하지만 자바는 이미 비슷한 날짜 클래스를 제공한다. SerialDate가 왜 필요할까? 데이비드는 나 역시 자주 느꼈던
불편함을 없애고자 SerialDate 클래스를 구현했다. 데이비드 의도에 꼬투리를 달 수 있지만 나 역시 같은 문제를 겪었으므로 시간 기반 날짜 클래스보다 순수 날짜 클래스를 환영하는 바이다.

### 첫째, 돌려보자

> SerialDate 클래스는 단위 테스트 케이스 몇개를 포함한다. 돌려보면 실패하는 테스트 케이스는 없다. 하지만 테스트케이스를 돌려보면 모든 경우를 점검하지 않는다.
> 그래서 코드 커버리지 분석 도구인 클로버를 이용해 단위 테스트가 실행하는 코드와 실행하지 않는 코드를 조사했다. 실행 가능한 문장 중 단위 테스트가 실행하는 문장은 약 50%였다.
> 클래스를 철저히 이해하고 리팩터링 하려면 훨씬 높은 테스트 커버리지가 필요했다. 그래서 나는 독자적으로 단위 테스트 케이스를 구현했다. 리팩터링하면서 모든 테스트 케이스를 통과하게 코드를 손보려고한다.

### 둘째, 고쳐보자

> 1. 처음에 나오는 주석은 너무 오래되었다. 그래서 간단하게 고치고 개선했다.
> 2. enum을 모두 독자적인 소스 파일로 옮겼다.
> 3. 정적 변수와 정적 메서드를 DateUtil이라는 새 클래스로 옮겼다.
> 4. 일부 추상 메서드를 DayDate 클래스로 끌어올렸다.
> 5. Month.make를 Month.fromInt로 변경했다. 다른 enum도 똑같이 변경했다. 또한 모든 enum에 toInt() 접근자를 생성하고 index 필드를 private로 정의했다.
> 6. plusYear와 plusMonths에 흥미로운 중복이 있었다. correctLastDayOfMonth라는 새 메서드를 생성해 중복을 없앴다. 그래서 세 메서드가 모두 좀 명확해졌다.
> 7. 팔방미인으로 사용하던 숫자 1을 없앴다. Month.JANUARY.toInt() 혹은 Day.SUNDAY.toInt()로 적절히 변경했다. 알고리즘을 조금 손봤다.

### 결론

다시 한 번 우리는 보이스카우트 규칙을 따랐다. 체크아웃한 코드보다 좀 더 깨끗한 코드를 체크인하게 되었다. 시간은 걸렸지만 가치 있는 작업이었다.
테스트 커버리지가 증가했으며 버 몇 개를 고쳤으며 코드 크기가 줄었고 코드가 명확해졌다. 다ㅁ 사람은 우리보다 코드를 좀 더 쉽게 이해하리라.
그래서 우리 보다 코드를 좀 더 쉽게 개선하리라.
